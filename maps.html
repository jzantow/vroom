<!DOCTYPE html>
<html>
<head>
Â  <title>Combined Coverage Map</title>
Â  <meta charset="utf-8" />
Â  <style>
Â  Â  html, body, #map {
Â  Â  Â  height: 100%;
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 0;
Â  Â  }
Â  Â  #controls {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 10px;
Â  Â  Â  left: 10px;
Â  Â  Â  z-index: 5;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  gap: 5px;
Â  Â  Â  background: rgba(255, 255, 255, 0.9);
Â  Â  Â  padding: 8px;
Â  Â  Â  border-radius: 5px;
Â  Â  Â  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
Â  Â  }
Â  Â  input[type="text"] {
Â  Â  Â  padding: 6px;
Â  Â  Â  font-size: 14px;
Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  border-radius: 4px;
Â  Â  Â  width: 250px;
Â  Â  }
Â  Â  .control-btn {
Â  Â  Â  padding: 6px 12px;
Â  Â  Â  font-size: 14px;
Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  border-radius: 4px;
Â  Â  Â  background: white;
Â  Â  Â  cursor: pointer;
Â  Â  Â  user-select: none;
Â  Â  Â  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
Â  Â  }
Â  Â  #legend {
Â  Â  Â  position: absolute;
Â  Â  Â  bottom: 10px;
Â  Â  Â  right: 10px;
Â  Â  Â  z-index: 5;
Â  Â  Â  background: white;
Â  Â  Â  padding: 10px;
Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  Â  font-size: 14px;
Â  Â  Â  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
Â  Â  Â  border-radius: 5px;
Â  Â  }
Â  Â  .legend-color {
Â  Â  Â  display: inline-block;
Â  Â  Â  width: 15px;
Â  Â  Â  height: 15px;
Â  Â  Â  margin-right: 6px;
Â  Â  Â  vertical-align: middle;
Â  Â  Â  border-radius: 3px;
Â  Â  }
Â  Â  .legend-color.store      { background: #FF6347; } /* Red-Orange */
Â  Â  .legend-color.station    { background: #1E90FF; } /* Blue */
Â  Â  .legend-color.billboard { background: #32CD32; } /* Green */
Â  </style>

Â  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDlgV94Xs1mTP01IZo3wqQWpx9png3l4DE&libraries=geometry"></script>
</head>
<body>
Â  <div id="controls">
Â  Â  <input id="storeSearchBox" type="text" placeholder="Search for store (e.g. 97, Burley)" />
Â  Â  <button id="storeSearchBtn" class="control-btn">Search Store</button>
Â  Â  <input id="stationSearchBox" type="text" placeholder="Search for station (e.g. KDIL)" />
Â  Â  <button id="stationSearchBtn" class="control-btn">Search Station</button>
Â  Â  <input id="billboardSearchBox" type="text" placeholder="Search by ON # (e.g. 31555)" />
Â  Â  <button id="billboardSearchBtn" class="control-btn">Search Billboard</button>
Â  Â  <button id="resetBtn" class="control-btn">Reset</button>

Â  Â  <hr style="width:100%; margin:10px 0;">

Â  Â  <div id="filters">
Â  Â  Â  Â  <label><input type="checkbox" id="storesCheckbox" checked> Stores</label>
Â  Â  Â  Â  <label><input type="checkbox" id="stationsCheckbox" checked> Stations</label>
Â  Â  Â  Â  <label><input type="checkbox" id="billboardsCheckbox" checked> Billboards</label>
Â  Â  </div>
Â  </div>

Â  <div id="map"></div>

Â  <div id="legend">
Â  Â  <h3>Legend</h3>
Â  Â  <p><span class="legend-color store"></span> Store</p>
Â  Â  <p><span class="legend-color station"></span> Station</p>
Â  Â  <p><span class="legend-color billboard"></span> Billboard</p>
Â  </div>

Â  <script>
Â  Â  let map;
Â  Â  const storeMarkers       = [];
Â  Â  const stationMarkers     = [];
Â  Â  const billboardMarkers   = [];
Â  Â  let highlightedMarker    = null;
Â  Â  let circles = [];
Â  Â  // Store data locally after fetching so it's available for functions like addStoreClickListener
Â  Â  let storeData = [];
Â  Â  let stationData = [];
Â  Â  let billboardData = [];

Â  Â  const COLORS = {
Â  Â  Â  "Store":       "#FF6347", // Red-Orange
Â  Â  Â  "Station":     "#1E90FF", // Blue
Â  Â  Â  "Billboard": "#32CD32"  // Green
Â  Â  };

Â  Â  function makeHighlightIcon() {
Â  Â  Â  return {
Â  Â  Â  Â  path: google.maps.SymbolPath.CIRCLE,
Â  Â  Â  Â  scale: 7,
Â  Â  Â  Â  fillColor: "#FFD700",
Â  Â  Â  Â  fillOpacity: 1,
Â  Â  Â  Â  strokeWeight: 1,
Â  Â  Â  Â  strokeColor: "#B8860B"
Â  Â  Â  };
Â  Â  }

Â  Â  function initMap() {
Â  Â  Â  map = new google.maps.Map(document.getElementById("map"), {
Â  Â  Â  Â  zoom: 5,
Â  Â  Â  Â  center: { lat: 42.53, lng: -114.36 },
Â  Â  Â  Â  gestureHandling: "greedy",
Â  Â  Â  Â  mapTypeControl: false,
Â  Â  Â  Â  scaleControl: true
Â  Â  Â  });

Â  Â  Â  const infoWindow = new google.maps.InfoWindow();

Â  Â  Â  // Define URLs for the data sources
Â  Â  Â  const storeDataURL = 'https://jzantow.github.io/vroom/stores.json';
Â  Â  Â  const stationDataURL = 'https://jzantow.github.io/vroom/stations.json';
Â  Â  Â  const billboardDataURL = 'https://jzantow.github.io/vroom/hqbillboards.json'; // ðŸš© Updated URL

Â  Â  Â  // Fetch all three JSON files at the same time
Â  Â  Â  Promise.all([
Â  Â  Â  Â  fetch(storeDataURL).then(res => res.json()),
Â  Â  Â  Â  fetch(stationDataURL).then(res => res.json()),
Â  Â  Â  Â  fetch(billboardDataURL).then(res => res.json())
Â  Â  Â  ]).then(([storeLocations, stationLocations, billboardLocations]) => {
Â  Â  Â  Â  // Store fetched data in variables for later use
Â  Â  Â  Â  storeData = storeLocations;
Â  Â  Â  Â  stationData = stationLocations;
Â  Â  Â  Â  billboardData = billboardLocations;
Â  Â  Â  
Â  Â  Â  Â  // --- Create Markers for Each Type ---
Â  Â  Â  Â  createMarkers(storeData);
Â  Â  Â  Â  createMarkers(stationData);
Â  Â  Â  Â  createMarkers(billboardData);

Â  Â  Â  Â  // Set up the initial state of the markers and filter listeners
Â  Â  Â  Â  updateMarkers();
Â  Â  Â  Â  document.getElementById('storesCheckbox').addEventListener('change', updateMarkers);
Â  Â  Â  Â  document.getElementById('stationsCheckbox').addEventListener('change', updateMarkers);
Â  Â  Â  Â  document.getElementById('billboardsCheckbox').addEventListener('change', updateMarkers);

Â  Â  Â  }).catch(err => console.error("Failed to load location data:", err));

Â  Â  Â  // --- Universal Marker Creation Function ---
Â  Â  Â  function createMarkers(locations) {
Â  Â  Â  Â  locations.forEach(loc => {
Â  Â  Â  Â  Â  const position = { lat: loc.Latitude, lng: loc.Longitude };
Â  Â  Â  Â  Â  const color = COLORS[loc.Type] || "#000";

Â  Â  Â  Â  Â  // Draw coverage circles for stations and billboards
Â  Â  Â  Â  Â  if (loc.Type === "Station" || loc.Type === "Billboard") {
Â  Â  Â  Â  Â  Â  const circle = new google.maps.Circle({
Â  Â  Â  Â  Â  Â  Â  strokeColor: color, strokeOpacity: 0.8, strokeWeight: 2,
Â  Â  Â  Â  Â  Â  Â  fillColor: color, fillOpacity: 0.25,
Â  Â  Â  Â  Â  Â  Â  center: position,
Â  Â  Â  Â  Â  Â  Â  radius: (loc.Radius || 0) * 1609.34, // Convert miles to meters
Â  Â  Â  Â  Â  Â  Â  map: map, clickable: false
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  circles.push(circle);
Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  const defaultIcon = {
Â  Â  Â  Â  Â  Â  path: google.maps.SymbolPath.CIRCLE, scale: 7, fillColor: color,
Â  Â  Â  Â  Â  Â  fillOpacity: 1, strokeWeight: 1, strokeColor: "#fff"
Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  const marker = new google.maps.Marker({
Â  Â  Â  Â  Â  Â  position: position, map: map,
Â  Â  Â  Â  Â  Â  title: String(loc.Name), icon: defaultIcon
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  marker.defaultIcon = defaultIcon;

Â  Â  Â  Â  Â  // Add appropriate click listener based on type
Â  Â  Â  Â  Â  if (loc.Type === "Store") {
Â  Â  Â  Â  Â  Â  addStoreClickListener(marker, loc);
Â  Â  Â  Â  Â  Â  storeMarkers.push(marker);
Â  Â  Â  Â  Â  } else if (loc.Type === "Station") {
Â  Â  Â  Â  Â  Â  addStationClickListener(marker, loc);
Â  Â  Â  Â  Â  Â  stationMarkers.push(marker);
Â  Â  Â  Â  Â  } else if (loc.Type === "Billboard") {
Â  Â  Â  Â  Â  Â  addBillboardClickListener(marker, loc);
Â  Â  Â  Â  Â  Â  billboardMarkers.push(marker);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  }

Â  Â  Â  // --- Click Listener for STORES ---
Â  Â  Â  function addStoreClickListener(marker, loc) {
Â  Â  Â  Â  marker.addListener("click", () => {
Â  Â  Â  Â  Â  highlightMarker(marker);
Â  Â  Â  Â  Â  const storeLatLng = marker.getPosition();

Â  Â  Â  Â  Â  // Use the new, globally available `stationData` and `billboardData` arrays
Â  Â  Â  Â  Â  const inRangeStations = stationData.filter(st => {
Â  Â  Â  Â  Â  Â  const itemLatLng = new google.maps.LatLng(st.Latitude, st.Longitude);
Â  Â  Â  Â  Â  Â  return google.maps.geometry.spherical.computeDistanceBetween(storeLatLng, itemLatLng) <= (st.Radius || 0) * 1609.34;
Â  Â  Â  Â  Â  }).map(st => st.Name);
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  const inRangeBillboards = billboardData.filter(bb => {
Â  Â  Â  Â  Â  Â  const itemLatLng = new google.maps.LatLng(bb.Latitude, bb.Longitude);
Â  Â  Â  Â  Â  Â  return google.maps.geometry.spherical.computeDistanceBetween(storeLatLng, itemLatLng) <= (bb.Radius || 0) * 1609.34;
Â  Â  Â  Â  Â  }).map(bb => `ON #${bb.Name}`);

Â  Â  Â  Â  Â  const content = `
Â  Â  Â  Â  Â  Â  <strong>${loc.Name}</strong><br><br>
Â  Â  Â  Â  Â  Â  <b>Stations In Range:</b><br>
Â  Â  Â  Â  Â  Â  ${inRangeStations.length ? inRangeStations.join("<br>") : "None"}
Â  Â  Â  Â  Â  Â  <br><br>
Â  Â  Â  Â  Â  Â  <b>Nearby Billboards:</b><br>
Â  Â  Â  Â  Â  Â  ${inRangeBillboards.length ? inRangeBillboards.join("<br>") : "None"}
Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  infoWindow.setContent(content);
Â  Â  Â  Â  Â  infoWindow.open(map, marker);
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  // --- Click Listener for STATIONS ---
Â  Â  Â  function addStationClickListener(marker, loc) {
Â  Â  Â  Â  marker.addListener("click", () => {
Â  Â  Â  Â  Â  highlightMarker(marker);
Â  Â  Â  Â  Â  infoWindow.setContent(`<strong>${loc.Name}</strong>`);
Â  Â  Â  Â  Â  infoWindow.open(map, marker);
Â  Â  Â  Â  });
Â  Â  Â  }

Â  Â  Â  // --- Click Listener for BILLBOARDS (from your file) ---
Â  Â  Â  function addBillboardClickListener(marker, loc) {
Â  Â  Â  Â  marker.addListener("click", () => {
Â  Â  Â  Â  Â  highlightMarker(marker);
Â  Â  Â  Â  Â  const content = `
Â  Â  Â  Â  Â  Â  <strong>ON #${loc.Name}</strong><br>
Â  Â  Â  Â  Â  Â  <b>Board Type:</b> ${loc["Board Type"] || "N/A"}<br>
Â  Â  Â  Â  Â  Â  <b>Location:</b> ${loc.Info || "N/A"}<br>
Â  Â  Â  Â  Â  Â  <b>Live Dates:</b><br>${(loc["Live Dates"] || "N/A").replace(/\n/g, "<br>")}<br>
Â  Â  Â  Â  Â  Â  <b>Buyer:</b> ${loc["Buyer"] || "N/A"}<br>
Â  Â  Â  Â  Â  Â  <b>Associated Store(s):</b> ${loc["Associated Store(s)"] || "N/A"}<br>
Â  Â  Â  Â  Â  Â  <b>Directional:</b> ${loc["Directional"] || "N/A"}<br>
Â  Â  Â  Â  Â  Â  <b>Creative:</b> ${loc.Creative ? `<a href="${loc.Creative}" target="_blank">View</a>` : "N/A"}<br>
Â  Â  Â  Â  Â  Â  ${loc["POP Photo"] ? `<b>POP Photo:</b> <a href="${loc["POP Photo"]}" target="_blank">View</a>` : ""}
Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  infoWindow.setContent(content);
Â  Â  Â  Â  Â  infoWindow.open(map, marker);
Â  Â  Â  Â  });
Â  Â  Â  }

Â  Â  Â  function highlightMarker(marker) {
Â  Â  Â  Â  if (highlightedMarker && highlightedMarker !== marker) {
Â  Â  Â  Â  Â  highlightedMarker.setIcon(highlightedMarker.defaultIcon);
Â  Â  Â  Â  }
Â  Â  Â  Â  marker.setIcon(makeHighlightIcon());
Â  Â  Â  Â  highlightedMarker = marker;
Â  Â  Â  }

Â  Â  // --- Filter Function ---
Â  Â  function updateMarkers() {
Â  Â  Â  Â  const showStores = document.getElementById('storesCheckbox').checked;
Â  Â  Â  Â  const showStations = document.getElementById('stationsCheckbox').checked;
Â  Â  Â  Â  const showBillboards = document.getElementById('billboardsCheckbox').checked;

Â  Â  Â  Â  // Toggle visibility of markers
Â  Â  Â  Â  storeMarkers.forEach(marker => {
Â  Â  Â  Â  Â  Â  marker.setMap(showStores ? map : null);
Â  Â  Â  Â  });

Â  Â  Â  Â  stationMarkers.forEach(marker => {
Â  Â  Â  Â  Â  Â  marker.setMap(showStations ? map : null);
Â  Â  Â  Â  });

Â  Â  Â  Â  billboardMarkers.forEach(marker => {
Â  Â  Â  Â  Â  Â  marker.setMap(showBillboards ? map : null);
Â  Â  Â  Â  });
Â  Â  }
Â  Â  Â  
Â  Â  Â  // Reusable search function
Â  Â  Â  function performSearch(query, markers, notFoundMessage) {
Â  Â  Â  Â  if (!query) return;
Â  Â  Â  Â  const match = markers.find(m => m.getTitle().toLowerCase().includes(query));

Â  Â  Â  Â  if (match) {
Â  Â  Â  Â  Â  map.setCenter(match.getPosition());
Â  Â  Â  Â  Â  map.setZoom(10);
Â  Â  Â  Â  Â  google.maps.event.trigger(match, "click");
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  alert(notFoundMessage);
Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â  // --- Search Event Listeners ---
Â  Â  Â  document.getElementById("storeSearchBtn").addEventListener("click", () => {
Â  Â  Â  Â  const query = document.getElementById("storeSearchBox").value.trim().toLowerCase();
Â  Â  Â  Â  // Custom store search to handle "#" prefixes
Â  Â  Â  Â  const match = storeMarkers.find(m => {
Â  Â  Â  Â  Â  const title = m.getTitle().toLowerCase();
Â  Â  Â  Â  Â  const numMatch = title.match(/#?(\d+)/);
Â  Â  Â  Â  Â  return title.includes(query) || (numMatch && numMatch[1] === query.replace("#", ""));
Â  Â  Â  Â  });
Â  Â  Â  Â  if (match) { map.setCenter(match.getPosition()); map.setZoom(10); google.maps.event.trigger(match, "click"); }
Â  Â  Â  Â  else { alert("No matching store found."); }
Â  Â  Â  });
Â  Â  Â  document.getElementById("stationSearchBtn").addEventListener("click", () => {
Â  Â  Â  Â  const query = document.getElementById("stationSearchBox").value.trim().toLowerCase();
Â  Â  Â  Â  performSearch(query, stationMarkers, "No matching station found.");
Â  Â  Â  });
Â  Â  Â  document.getElementById("billboardSearchBtn").addEventListener("click", () => {
Â  Â  Â  Â  const query = document.getElementById("billboardSearchBox").value.trim().toLowerCase();
Â  Â  Â  Â  performSearch(query, billboardMarkers, "No matching billboard found.");
Â  Â  Â  });

Â  Â  Â  // --- Reset Button ---
Â  Â  Â  document.getElementById("resetBtn").addEventListener("click", () => {
Â  Â  Â  Â  document.getElementById("storeSearchBox").value = "";
Â  Â  Â  Â  document.getElementById("stationSearchBox").value = "";
Â  Â  Â  Â  document.getElementById("billboardSearchBox").value = "";
Â  Â  Â  Â  map.setZoom(5);
Â  Â  Â  Â  map.setCenter({ lat: 42.53, lng: -114.36 });
Â  Â  Â  Â  if (highlightedMarker) {
Â  Â  Â  Â  Â  highlightedMarker.setIcon(highlightedMarker.defaultIcon);
Â  Â  Â  Â  Â  highlightedMarker = null;
Â  Â  Â  Â  }
Â  Â  Â  Â  infoWindow.close();
Â  Â  Â  });
Â  Â  }

Â  Â  window.onload = initMap;
Â  </script>
</body>
</html>
